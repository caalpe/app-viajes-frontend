<div class="modal-backdrop" (click)="onClose()"></div>

<div class="modal-container" (click)="$event.stopPropagation()">
  <div class="modal-header">
    <h3><i class="bi bi-bar-chart-fill me-2"></i>Crear encuesta</h3>
    <button class="btn-close-modal" (click)="onClose()">
      <i class="bi bi-x-lg"></i>
    </button>
  </div>

  <form [formGroup]="surveyForm" (ngSubmit)="onSubmit()">
    <div class="modal-body">
      <!-- Pregunta -->
      <div class="form-group">
        <label for="question">Pregunta de la encuesta *</label>
        <input
          type="text"
          id="question"
          formControlName="question"
          placeholder="¿Cuál es tu pregunta?"
          [class.is-invalid]="questionControl?.invalid && questionControl?.touched"
        />
        @if (questionControl?.invalid && questionControl?.touched) {
          <div class="invalid-feedback">
            @if (questionControl?.errors?.['required']) {
              La pregunta es obligatoria
            }
            @if (questionControl?.errors?.['minlength']) {
              Mínimo 5 caracteres
            }
            @if (questionControl?.errors?.['maxlength']) {
              Máximo 200 caracteres
            }
          </div>
        }
        <small class="char-counter">{{ questionControl?.value?.length || 0 }} / 200</small>
      </div>

      <!-- Opciones -->
      <div class="form-group">
        <div class="options-header">
          <label>Opciones de respuesta *</label>
          <button
            type="button"
            class="btn-add-option"
            (click)="addOption()"
            [disabled]="options.length >= 10"
          >
            <i class="bi bi-plus-circle me-1"></i>
            Añadir opción
          </button>
        </div>

        <div class="options-list" formArrayName="options">
          @for (option of options.controls; track $index; let i = $index) {
            <div class="option-item" [formGroupName]="i">
              <span class="option-number">{{ i + 1 }}</span>
              <input
                type="text"
                formControlName="text"
                placeholder="Escribe una opción..."
                [class.is-invalid]="option.get('text')?.invalid && option.get('text')?.touched"
              />
              @if (options.length > 2) {
                <button
                  type="button"
                  class="btn-remove-option"
                  (click)="removeOption(i)"
                  title="Eliminar opción"
                >
                  <i class="bi bi-trash"></i>
                </button>
              }
            </div>
            @if (option.get('text')?.invalid && option.get('text')?.touched) {
              <div class="invalid-feedback-small">
                Opción obligatoria (máx. 100 caracteres)
              </div>
            }
          }
        </div>

        <small class="help-text">
          <i class="bi bi-info-circle me-1"></i>
          Mínimo 2 opciones, máximo 10
        </small>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn-cancel" (click)="onClose()">
        Cancelar
      </button>
      <button type="submit" class="btn-create">
        <i class="bi bi-check-circle me-1"></i>
        Crear encuesta
      </button>
    </div>
  </form>
</div>
