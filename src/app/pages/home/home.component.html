<section class="hero">
	<div class="hero-inner container">
		@if (userName) {
			<h1 class="display-4 fw-bold">Bienvenido <span class="d-block">{{ userName }}</span></h1>
			<p class="lead">Explora y encuentra tu próxima aventura a medida.</p>
		} @else {
			<h1>Viaja. Descubre. Vive.</h1>
			<p class="lead">Encuentra las mejores ofertas y experiencias únicas para tu próxima aventura.</p>
		}

		<form class="search-form" [formGroup]="searchForm" (ngSubmit)="onSearch()">
			<div class="field">
				<label class="label-accent">Destino</label>
				<input type="text" formControlName="destination" placeholder="¿A dónde?" list="destinations" />
				<datalist id="destinations">
					@for (dest of destinations; track dest) {
						<option [value]="dest"></option>
					}
				</datalist>
			</div>

			<div class="field">
				<label class="label-accent" [class.label-error]="searchForm.errors?.['dateRange']">Desde</label>
				<input type="date" formControlName="from" placeholder="dd/mm/aaaa"
					[class.input-error]="searchForm.errors?.['dateRange'] && (fromControl?.touched || toControl?.touched)" />
			</div>

			<div class="field">
				<label class="label-accent" [class.label-error]="searchForm.errors?.['dateRange']">Hasta</label>
				<input type="date" formControlName="to" placeholder="dd/mm/aaaa"
					[class.input-error]="searchForm.errors?.['dateRange'] && (fromControl?.touched || toControl?.touched)" />
			</div>

		<div class="field">
			<label class="label-accent label-budget">Coste máximo</label>
			<div class="input-with-addon">
				<input type="number" formControlName="budget" min="0" placeholder="Máx. €" />
				<span class="addon">€</span>
			</div>
		</div>

		@if (searchForm.errors?.['dateRange']) {
			<div class="form-error-full">
				La fecha "Desde" debe ser anterior o igual a la fecha "Hasta".
			</div>
		}

		@if (budgetControl?.invalid && (budgetControl?.dirty || budgetControl?.touched)) {
			<div class="form-error-full">
				El presupuesto debe ser un número mayor o igual a 0.
			</div>
		}
		<div class="field action-bottom d-flex gap-2">
			<button class="btn primary" type="submit">Buscar</button>
			<button class="btn btn-secondary" type="button" (click)="clearFilters()">Limpiar filtros</button>
		</div>
		</form>
	</div>
</section>

<section class="features container">
	<div class="features-grid">
		@for (f of features; track f.title) {
			<div class="feature">
				<h3>{{ f.title }}</h3>
				<p>{{ f.desc }}</p>
			</div>
		}
	</div>
</section>

<section class="trips container">
	<h2>Viajes recomendados</h2>
	<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
		@for (t of (trips$ | async); track t.id_trip) {
			<div class="col">
				<article class="card shadow-sm">
					<div class="pt-4">
						<img [src]="t.image_url" alt="" class="img-fluid card-image">
					</div>
					<div class="card-body">
						<h3 class="card-title">{{ t.title }}</h3>
						<div>
							<i class="bi bi-geo-alt pe-2"></i>
							<span class="card-text">{{ t.departure || 'Sin especificar' }}</span>
							<i class="bi bi-arrow-right pe-2"></i>
							<span class="card-text">{{ t.destination || t.description }}</span>
						</div>
						<div>
							<i class="bi bi-calendar pe-2"></i>
							<span class="card-text">{{ t.start_date || t.availableFrom || 'Disponible' }}</span>
						</div>
						<div>
							<i class="bi bi-people pe-2"></i>
							<span class="card-text">{{ t.min_participants || 'Varios' }} personas</span>
						</div>
						<div>
							<i class="bi bi-cash pe-2"></i>
							<span class="card-text">{{ t.cost_per_person || t.priceNumber || t.price }} €</span>
						</div>
					</div>

					<a [routerLink]="['/trips', t.id_trip || t.id]" class="stretched-link"></a>
				</article>
			</div>
		}
	</div>

	<!-- Pagination controls -->
	<div class="pagination mt-4 d-flex align-items-center justify-content-center gap-3 flex-wrap">
		@let cp = (currentPage$ | async);
		<button class="btn btn-outline-primary" (click)="goToPage(1)" [disabled]="cp === 1">« Primero</button>
		<button class="btn btn-outline-primary" (click)="goToPage((cp || 1) - 1)" [disabled]="cp === 1">‹ Anterior</button>
		<span>Página {{ cp }} de {{ totalPages }}</span>
		<button class="btn btn-outline-primary" (click)="goToPage((cp || 1) + 1)" [disabled]="cp === totalPages">Siguiente ›</button>
		<button class="btn btn-outline-primary" (click)="goToPage(totalPages)" [disabled]="cp === totalPages">Último »</button>

		<!-- Page size selector moved here -->
		<label class="ms-3">Por página
			<select class="form-select d-inline-block w-auto ms-2" [value]="pageSize" (change)="setPageSize($any($event.target).value)">
				<option [value]="6">6</option>
				<option [value]="9">9</option>
				<option [value]="12">12</option>
			</select>
		</label>
	</div>

	<div class="mt-2 text-center">
		<span>Mostrando {{ (trips$ | async)?.length || 0 }} de {{ totalItems }} resultados</span>
	</div>
</section>

<section class="cta">
	<div class="container cta-inner">
		<h2>Listo para tu próxima aventura?</h2>
		<p>Reserva ahora y obtén descuentos exclusivos en destinos seleccionados.</p>
		<a routerLink="/trips" class="btn primary large">Empieza ahora</a>
	</div>
</section>
